{{ - if .Values.secrets.createSaltsSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "wordpress.fullname" . }}-salts
type: Opaque
data:
  # retrieve the secret data using lookup function and when not exists, return an empty dictionary / map as result
  {{- $secretObj := (lookup "v1" "Secret" .Release.Namespace (printf "%s-%s" (include "wordpress.fullname" $) "salts")) | default dict }}
  {{- $secretData := (get $secretObj "data") | default dict }}
  {{- $authKey := (get $secretData "WORDPRESS_AUTH_KEY") | default (randAlphaNum 32 | b64enc) }}
  {{- $secureAuthKey := (get $secretData "WORDPRESS_SECURE_AUTH_KEY") | default (randAlphaNum 32 | b64enc) }}
  {{- $loggedInKey := (get $secretData "WORDPRESS_LOGGED_IN_KEY") | default (randAlphaNum 32 | b64enc) }}
  {{- $nonceKey := (get $secretData "WORDPRESS_NONCE_KEY") | default (randAlphaNum 32 | b64enc) }}
  {{- $authSalt := (get $secretData "WORDPRESS_AUTH_SALT") | default (randAlphaNum 32 | b64enc) }}
  {{- $secureAuthSalt := (get $secretData "WORDPRESS_SECURE_AUTH_SALT") | default (randAlphaNum 32 | b64enc) }}
  {{- $loggedInSalt := (get $secretData "WORDPRESS_LOGGED_IN_SALT") | default (randAlphaNum 32 | b64enc) }}
  {{- $nonceSalt := (get $secretData "WORDPRESS_NONCE_SALT") | default (randAlphaNum 32 | b64enc) }}
  WORDPRESS_AUTH_KEY: {{ $authKey | quote }}
  WORDPRESS_SECURE_AUTH_KEY: {{ $secureAuthKey | quote }}
  WORDPRESS_LOGGED_IN_KEY: {{ $loggedInKey | quote }}
  WORDPRESS_NONCE_KEY: {{ $nonceKey | quote }}
  WORDPRESS_AUTH_SALT: {{ $authSalt | quote }}
  WORDPRESS_SECURE_AUTH_SALT: {{ $secureAuthSalt | quote }}
  WORDPRESS_LOGGED_IN_SALT: {{ $loggedInSalt | quote }}
  WORDPRESS_NONCE_SALT: {{ $nonceSalt | quote }}
{{- end }}
---
# Only if secrets.createDbSecret is true
{{ - if .Values.secrets.createDbSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name | trunc 63 | trimSuffix "-" }}-db
type: Opaque
data:
  # retrieve the secret data using lookup function and when not exists, return an empty dictionary / map as result
  {{- $secretObj := (lookup "v1" "Secret" .Release.Namespace (printf "%s-%s" (include "wordpress.fullname" $) "db")) | default dict }}
  {{- $secretData := (get $secretObj "data") | default dict }}
  {{- $dbName := (get $secretData "WORDPRESS_DB_NAME") | default (printf "wp_%s" (randAlphaNum 8) | trunc 16 | b64enc) }}
  {{- $dbUser := (get $secretData "WORDPRESS_DB_USER") | default (printf "wp_user_%s" (randAlphaNum 8) | trunc 16 | b64enc) }}
  {{- $dbPassword := (get $secretData "WORDPRESS_DB_PASSWORD") | default (randAlphaNum 16 | b64enc) }}
  WORDPRESS_DB_NAME: {{ $dbName | quote }}
  WORDPRESS_DB_USER: {{ $dbUser | quote }}
  WORDPRESS_DB_PASSWORD: {{ $dbPassword | quote }}
{{- end }}
